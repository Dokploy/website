---
title: Zero Downtime
description: Learn how to configure zero downtime deployments in Dokploy.
---

import Link from 'next/link';

By default, when you create a new deployment, it will stop the latest running container and start the new one. This is the default behavior of Docker Swarm and this leads to Bad Gateway since
the containers are initialized at the same time.

Dokploy allows you to configure zero downtime deployments, which means that you can deploy your application without any disruption.

## Steps to configure Zero Downtime Deployments

Suppose we have a NodeJS application running on port 3000 with a health check route `/api/health` that returns a 200 status code.
To enable zero-downtime,

1. Go to the `Advanced` Tab, under Cluster Settings, and click the button `Swarm Settings`
2. Paste the code below in the `Health Check` field:
    ```json
    {
      "Test": [
        "CMD",
        "curl",
        "-f",
        "http://127.0.0.1:3000/api/health"
      ],
      "Interval": 30000000000,
      "Timeout": 10000000000,
      "StartPeriod": 30000000000,
      "Retries": 3
    }
    ```
    Note:
    1. Ensure the API Route exists in your application
    2. For Dockerfile deployments, ensure that
        - your host is configured to listen to 127.0.0.1 (or 0.0.0.0). For example, for NextJS Dockerfile, ensure `ENV HOSTNAME=0.0.0.0` is set.
        - your docker image has `curl` installed - this is not available by default on alpine-based images. Alternatively, you can use wget:
            ```json
            "Test": [
              "CMD",
              "wget",
              "--spider",
              "-q",
              "http://127.0.0.1:3000/api/health"
            ],
            ```

Additionally, you are recommended to also configure <Link href="./zero-downtime">rollbacks</Link> for your application in production.

## Example

- We will use this example [Github Repo](https://github.com/Dokploy/swarm-test)
- It has an endpoint called `/health` [endpoint](https://github.com/Dokploy/swarm-test/blob/main/index.js#L20) which will inform us if our application is healthy
- For testing purposes, I've invoked a sleep function to simulate delays. This will allow us to see the "Bad Gateway" error between deployments

**Use Git Provider in Your Application**:
   - Repository: `https://github.com/Dokploy/swarm-test`
   - Branch: `main`
   - Build path: `/`

To verify that zero downtime deployment is not yet enabled, follow these steps:
1. Deploy the application.
2. Initiate another deployment.
3. While the deployment is in progress, reload the /health page.
4. You should observe a Bad Gateway error, indicating downtime during the deployment process.

To configure health checks for zero downtime.
1. Go to the `Advanced` tab of the application.
2. Navigate to `Swarm Settings`.
3. Locate the `Health Checks` section.
4. Replace the existing configuration with the following:

```json
{
  "Test": [
    "CMD",
    "curl",
    "-f",
    "http://localhost:3000/health"
  ],
  "Interval": 30000000000,
  "Timeout": 10000000000,
  "StartPeriod": 30000000000,
  "Retries": 3
}
```

This configuration instructs Docker to:

1. Send a request inside the container to http://127.0.0.1:3000/health.
2. Perform health checks every 30 seconds (30,000,000,000 nanoseconds).
3. Wait up to 10 seconds (10,000,000,000 nanoseconds) for a response.
4. Allow the container 30 seconds (30,000,000,000 nanoseconds) to start before running checks.
5. Retry the health check 3 times before considering the container unhealthy.

With this setup, new deployments will only replace old containers after the new instance passes health checks, preventing downtime ðŸŽŠ.
